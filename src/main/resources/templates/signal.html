<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–¥–∞–≤–∞–Ω–µ –Ω–∞ —Å–∏–≥–Ω–∞–ª - AI –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä –∑–∞ —Ç–æ—Ä–º–æ–∑</title>
    <link rel="stylesheet" th:href="@{/css/signal.css}">
</head>
<body>
    <div class="container">
        <div class="header">
            <a th:href="@{/}" class="back-home-btn">‚Üê –ù–∞—á–∞–ª–æ</a>
            <div class="logo-container">
                <img src="https://dl.dropboxusercontent.com/scl/fi/rdvg6s0wduwowlzdlrgo7/hands-black.png?rlkey=lnbl02k330tvjbgpzh4j4duhk&st=ra0hbrv5&dl=1" 
                     alt="SAFESPACE Logo" class="logo-img">
            </div>
            <h1>–ü–æ–¥–∞–≤–∞–Ω–µ –Ω–∞ —Å–∏–≥–Ω–∞–ª –∑–∞ —Ç–æ—Ä–º–æ–∑</h1>
            <div class="header-actions">
            </div>
        </div>

        <!-- Welcome message for logged in users -->
        <div class="welcome-message" sec:authorize="isAuthenticated()" th:if="${userFullName}">
            <div class="welcome-content">
                <span class="welcome-icon">üëã</span>
                <div class="welcome-text">
                    <strong>–î–æ–±—Ä–µ –¥–æ—à–ª–∏, <span th:text="${userFullName}">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª</span>!</strong>
                    <p>–ú–æ–∂–µ—Ç–µ –¥–∞ –ø–æ–¥–∞–¥–µ—Ç–µ —Å–∏–≥–Ω–∞–ª –ø–æ-–¥–æ–ª—É. –í–∞—à–∞—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —â–µ –±—ä–¥–µ —Å–≤—ä—Ä–∑–∞–Ω–∞ —Å —Ç–æ–∑–∏ —Å–∏–≥–Ω–∞–ª.</p>
                </div>
                <div class="welcome-logout">
                    <form th:action="@{/logout}" method="post" style="display: inline;">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <button type="submit" class="logout-btn">–ò–∑—Ö–æ–¥</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="content">
            <form th:action="@{/signal}" method="post" th:object="${signal}">
                <div class="form-group">
                    <label for="whoIsBullying">–ö–æ–π –≤–∏ —Ç–æ—Ä–º–æ–∑–∏?</label>
                    <select id="whoIsBullying" name="whoIsBullying" class="form-control">
                        <option value="Student">–£—á–µ–Ω–∏–∫</option>
                        <option value="Teacher">–£—á–∏—Ç–µ–ª</option>
                        <option value="Parent">–†–æ–¥–∏—Ç–µ–ª</option>
                        <option value="Other">–î—Ä—É–≥–æ</option>
                    </select>
                </div>

                <!-- Show message if logged in -->
                <div class="form-group auth-info" th:if="${isAuthenticated}">
                    <div class="info-box">
                        <strong>‚úì –í–ª–µ–∑–ª–∏ —Å—Ç–µ –∫–∞—Ç–æ: <span th:text="${userFullName}">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª</span></strong>
                        <p>–ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ –≤–∞—à–∏—è—Ç —Å–∏–≥–Ω–∞–ª —â–µ –±—ä–¥–µ —Å–≤—ä—Ä–∑–∞–Ω —Å –≤–∞—à–∏—è –∞–∫–∞—É–Ω—Ç. –ú–æ–∂–µ—Ç–µ –¥–∞ –∏–∑–±–µ—Ä–µ—Ç–µ –¥–∞ –ø–æ–¥–∞–¥–µ—Ç–µ —Å–∏–≥–Ω–∞–ª–∞ –∞–Ω–æ–Ω–∏–º–Ω–æ –ø–æ-–¥–æ–ª—É.</p>
                    </div>
                </div>

                <!-- Show anonymous checkbox ONLY if logged in (guests are anonymous by default) -->
                <div class="form-group" th:if="${isAuthenticated}">
                    <label>
                        <input type="checkbox" name="anonymous" th:field="*{anonymous}" id="anonymousCheckbox">
                        –ü–æ–¥–∞–≤–∞–Ω–µ –∞–Ω–æ–Ω–∏–º–Ω–æ (—Å–∫—Ä–∏–≤–∞–Ω–µ –Ω–∞ —Å–∞–º–æ–ª–∏—á–Ω–æ—Å—Ç—Ç–∞ –º–∏)
                    </label>
                </div>

                <!-- Show name/phone fields only if NOT logged in and NOT anonymous -->
                <div class="form-group" id="nameGroup" th:if="${!isAuthenticated}" style="display: none;">
                    <label for="studentName">–í–∞—à–µ—Ç–æ –∏–º–µ (–Ω–µ–∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ, –∞–∫–æ –Ω–µ –µ –∞–Ω–æ–Ω–∏–º–Ω–æ)</label>
                    <input type="text" id="studentName" name="studentName" class="form-control" 
                           placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –≤–∞—à–µ—Ç–æ –∏–º–µ">
                </div>

                <div class="form-group" id="phoneGroup" th:if="${!isAuthenticated}" style="display: none;">
                    <label for="studentPhoneNumber">–í–∞—à–∏—è—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–µ–Ω –Ω–æ–º–µ—Ä (–Ω–µ–∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ, –∞–∫–æ –Ω–µ –µ –∞–Ω–æ–Ω–∏–º–Ω–æ)</label>
                    <input type="tel" id="studentPhoneNumber" name="studentPhoneNumber" class="form-control" 
                           placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –≤–∞—à–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–µ–Ω –Ω–æ–º–µ—Ä">
                </div>

                <div class="form-group">
                    <label for="bodyText">–û–ø–∏—à–µ—Ç–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞:</label>
                    <textarea id="bodyText" name="bodyText" th:field="*{bodyText}" 
                              class="form-control" rows="6" 
                              placeholder="–ú–æ–ª—è, –æ–ø–∏—à–µ—Ç–µ –∫–∞–∫–≤–æ —Å–µ –µ —Å–ª—É—á–∏–ª–æ –ø–æ–¥—Ä–æ–±–Ω–æ, –∫–∞—Ç–æ –∑–∞ –ø–æ-–¥–æ–±—Ä–∞ —Ç–æ—á–Ω–æ—Å—Ç –º–æ–∂–µ –¥–∞ –≤–∫–ª—é—á–∏—Ç–µ –∏–º–µ, —Ñ–∞–º–∏–ª–∏—è, –∫–ª–∞—Å, –≥—Ä—É–ø–∞, —É—á–∏—Ç–µ–ª –∏ –¥—Ä—É–≥–∏ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏..." required></textarea>
                </div>

                <button type="submit" class="btn btn-primary">–ò–∑–ø—Ä–∞—Ç–∏ —Å–∏–≥–Ω–∞–ª</button>
            </form>


            <div th:if="${showResult}" class="ai-response">
                <h2>–†–µ–∑—É–ª—Ç–∞—Ç –æ—Ç AI –∞–Ω–∞–ª–∏–∑</h2>
<!--                <div class="result-card">-->
                    <!-- Student Response (Main Message) -->
                    <div class="result-item student-message">
                        <h3>–û—Ç–≥–æ–≤–æ—Ä –∫—ä–º —É—á–µ–Ω–∏–∫–∞:</h3>
                        <p th:text="${signal.studentResponse != null ? signal.studentResponse : signal.aiAdvice}">Response will appear here</p>
                    </div>

                    <!-- Classification Details - Only visible to Teachers, Admins, and other professionals -->
                    <div class="classification-section" sec:authorize="hasAnyRole('Teacher', 'Admin', 'Psychologist', 'MedicalStaff')">
                        <h3>–ö–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (–∑–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∏):</h3>
                        <div class="classification-grid">
                            <div class="result-item">
                                <strong>–ò–∑—Ç–æ—á–Ω–∏–∫:</strong> 
                                <span th:text="${signal.source != null ? signal.source : 'unknown'}">unknown</span>
                            </div>
                            <div class="result-item">
                                <strong>–¢–∏–ø –ø—Ä–æ–±–ª–µ–º:</strong> 
                                <span th:text="${signal.type != null ? signal.type : 'other'}">other</span>
                            </div>
                            <div class="result-item">
                                <strong>–°–ø–µ—à–Ω–æ—Å—Ç:</strong> 
                                <span class="score" th:text="${signal.urgency != null ? signal.urgency : 1}">1</span>/5
                            </div>
                            <div class="result-item">
                                <strong>–°–µ—Ä–∏–æ–∑–Ω–æ—Å—Ç:</strong> 
                                <span class="score" th:text="${signal.severity != null ? signal.severity : 1}">1</span>/5
                            </div>
                            <div class="result-item">
                                <strong>–í–∞–∂–Ω–æ—Å—Ç:</strong> 
                                <span class="score" th:text="${signal.importance != null ? signal.importance : 1}">1</span>/5
                            </div>
                            <div class="result-item">
                                <strong>–î–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç:</strong> 
                                <span class="score" th:text="${signal.credibility != null ? signal.credibility : 1}">1</span>/5
                            </div>
                            <div class="result-item full-width">
                                <strong>–ü—Ä–µ–ø–æ—Ä—ä—á–∞–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ:</strong> 
                                <span class="action-badge" th:text="${signal.recommendedAction != null ? signal.recommendedAction : 'monitor'}">monitor</span>
                            </div>
                        </div>
                    </div>
<!--                </div>-->
            </div>

            <!-- Back to Home button after results -->
            <div class="back-home-section" style="text-align: center; margin-top: 30px;" th:if="${showResult}">
                <a th:href="@{/}" class="back-home-btn">‚Üê –ù–∞—á–∞–ª–æ</a>
            </div>
        </div>
    </div>

    <script>
        // Anonymous checkbox only exists for logged-in users
        // When checked, it means they want to submit anonymously even though logged in
        var anonymousCheckbox = document.getElementById('anonymousCheckbox');
        if (anonymousCheckbox) {
            // For logged-in users, the checkbox just toggles anonymous submission
            // No need to show/hide name/phone fields since they're not displayed for logged-in users
            anonymousCheckbox.addEventListener('change', function() {
                // Optional: You can add visual feedback here if needed
                console.log('Anonymous submission:', this.checked);
            });
        }
    </script>
</body>
</html>

